<!DOCTYPE html>
<html>
<head>
	<title>Map</title>
</head>
<body>
<canvas id="canvas" width="550" height="400" style="border: 1px solid #000000;">
	<img src="floor1.png" id="floor1">
	<img src="floor2.png" id="floor2">
</canvas>
<p id="reading"></p>
<p id="count"></p>
<p>Latitude: <input type="text" id="latitude"></p>
<p>Longitude: <input type="text" id="longitude"></p>
<button onclick="map.changeFloor()">Click me</button>
<script>
var ctx = document.getElementById("canvas").getContext("2d");
var x = document.getElementById("reading");
var map = {
	tile: document.getElementById("floor1"),
	floor: 1,
	changeFloor: function(){
		if (this.floor === 1){
			this.tile = document.getElementById("floor2");
			this.floor = 2;
		} else {
			this.tile = document.getElementById("floor1");
			this.floor = 1;
		}
	},
	move: function(lat, long){
		var output = {
			x: ((lat*1000000)-53524600)*-1.37,
			y: 80
		};
		return output;
	},
}
var readings = {
	count: 0.0,
	latitude: 0.0,
	longitude: 0.0,
	altitude: 0.0
};
/*

53.525667, -113.269564
x: -1470 ,
y: 80

corner of 216: 53.525287, -113.269566
x: -950,
y: 80,
change by -0.000380 = +520px
520/-380(millionths) = -1.37

top left of math depatment:
53.524962, -113.269562
x: -500,
y: 80,
change by -0.000325 = 450px
450/-325(millionths) = -1.38

top left of school
53.524533, -113.269612
x: 98,
y: 120
change by 0.001135 = 1568px
1568/-1134(millionths) = -1.38

****every millionth is 1.38 px****

+-0.000003 = +- 4px 
*/

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(processPosition);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function processPosition(position){
  readings.altitude = position.coords.altitude;
	if (readings.count < 30){
		readings.latitude += position.coords.latitude;
		readings.longitude += position.coords.longitude;
    readings.count += 1;
  } else {
  	readings.latitude = position.coords.latitude;
    readings.longitude = position.coords.longitude;
    readings.count = 1;
  }
  showPosition()
}

function showPosition() {
    x.innerHTML = "Latitude: " + (readings.latitude/readings.count).toFixed(6) + 
    "<br>Longitude: " + (readings.longitude/readings.count).toFixed(6) + 
    "<br>Altitude: " + readings.count;
}

function render(){
	ctx.clearRect(0,0,550,400);
	ctx.drawImage(map.tile, map.move((readings.latitude/readings.count).toFixed(6)).x, 80, map.tile.width/2, map.tile.height/2);
	ctx.fillRect(270, 195, 10, 10);
}
render();
setInterval(function(){
	getLocation();
	render();
}, 250);
</script>
</body>
</html>
