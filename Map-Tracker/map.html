<!DOCTYPE html>
<html>
<head>
	<title>Map</title>
</head>
<body>
<canvas id="canvas" width="550" height="400" style="border: 1px solid #000000;">
	<img src="floor1.png" id="floor1">
	<img src="floor2.png" id="floor2">
</canvas>
<p id="reading"></p>
<p id="count"></p>
<script>
var ctx = document.getElementById("canvas").getContext("2d");
var map = document.getElementById("floor1");
var x = document.getElementById("reading");
var readings = {
	count: 0.0,
	latitude: 0.0,
	longitude: 0.0,
	altitude: 0.0
};
//corner of 216: 53.525287, -113269566
var user = {
	x: -100,
	y: -100
};
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(processPosition);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function processPosition(position){
  readings.altitude = position.coords.altitude;
	if (readings.count < 30){
		readings.latitude += position.coords.latitude;
		readings.longitude += position.coords.longitude;
    readings.count += 1;
  } else {
  	readings.latitude = position.coords.latitude;
    readings.longitude = position.coords.longitude;
    readings.count = 1;
  }
  showPosition()
}

function showPosition() {
    x.innerHTML = "Latitude: " + (readings.latitude/readings.count).toFixed(6) + 
    "<br>Longitude: " + (readings.longitude/readings.count).toFixed(6) + 
    "<br>Altitude: " + readings.count;
    console.log(readings.count, readings.latitude)
}

function render(){
	ctx.drawImage(map, user.x,user.y, map.width/2, map.height/2);
}
render();
setInterval(function(){
	getLocation();
	render();
}, 250);
</script>
</body>
</html>
